<!DOCTYPE html>
<html>
<head>
  <title>X MONEY</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial; background:#0f172a; color:white; text-align:center; }
    button { padding:12px 20px; margin:10px; border:none; border-radius:8px; background:#22c55e; color:white; font-weight:bold; }
    .card { background:#1e293b; padding:20px; margin:20px; border-radius:12px; }
  </style><style>
  body {
    font-family: Arial;
    background:#0f172a;
    color:white;
    text-align:center;
    margin:0;
    padding-bottom:70px;
  }

  button {
    padding:12px 20px;
    margin:10px;
    border:none;
    border-radius:8px;
    background:#22c55e;
    color:white;
    font-weight:bold;
  }

  .card {
    background:#1e293b;
    padding:20px;
    margin:20px;
    border-radius:12px;
  }

  .nav {
    position:fixed;
    bottom:0;
    width:100%;
    background:#111827;
    display:flex;
    justify-content:space-around;
    padding:12px 0;
  }

  .nav a {
    color:white;
    text-decoration:none;
    font-weight:bold;
  }
</style>
</head>
<body>

<h2>X MONEY ðŸ’°</h2>

<div class="card">
  <p id="user"></p>
  <p>Balance: <span id="balance">0</span> Points</p>
</div>

<div class="card">
  <button onclick="watchAd()">Watch Ad ðŸŽ¬</button>
  <button onclick="goWithdraw()">Withdraw ðŸ’³</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const user = tg.initDataUnsafe.user;
  const telegramId = user.id;
  const username = user.username || "User";

  document.getElementById("user").innerText = "Welcome " + username;

  async function initUser() {
    await fetch("/api/init", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ telegramId, username })
    });
  }

  async function watchAd() {
    const points = Math.floor(Math.random() * 20) + 1;

    await fetch("/api/addPoints", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ telegramId, points })
    });

    alert("You earned " + points + " points!");
    location.reload();
  }

  function goWithdraw() {
    window.location.href = "/withdraw.html";
  }

  initUser();
</script>
<div class="nav">
  <a href="/index.html">Home</a>
  <a href="/tasks.html">Task</a>
  <a href="/withdraw.html">Withdraw</a>
</div>
</body>
</html>
